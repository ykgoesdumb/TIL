# 8. 입출력장치
## 8-1 장치 컨트롤러와 장치 드라이버

입출력 장치는 다루기 너무 까다롭다

- 너무 종류가 많음
- 데이터 전송률 낮음 (low transfer rate)

- 장치 컨트롤러 
- 장치 드라이버


### 장치 컨트롤러
> 입출력 장치는 컴퓨터에 직접 연결되지 않고 장치 컨트롤러 라는 하드웨어에 연결된다

- 입출력 제어기, 입출력 모듈 이라고도 불림


### 장치 컨트롤러 역할

- cpu 와 입출력 장치의 통신 중개
- 오류 검출
- 데이터 버퍼링
  - 버퍼: 서로 다른 데이터 전송률을 완화하기위한 장치
    - cpu 는 전송률 높고 입출력장치는 매우 낮다
    - 데이터를 버퍼에 모았다가 한번에 전송함으로써 이 격차를 줄임

### 장치 컨트롤러의 내부

- 데이터 레지스터
  - 그 '버퍼' 의 역할을 하는 부품
  - 최근엔 RAM 이 이역할을 하기도 함
- 상태 레지스터
  - 오류가 있는지 상태정보 저장
- 제어 레지스터
  - 제어 정보와 명령을 저장


### 장치 드라이버

- 장치 컨트롤러의 동작을 감지하고 제어함으로써 컨트롤러가 컴퓨터 내부와 정보를 주고 받게 하는 프로그램
- 메모리에 저장한다 프로그램이기 때문
- 드라이버를 인식하고 실행 할 수 있다면 그 장치는 제품 종류에 상관없이 컴퓨터 내부와 소통 가능


### 장치 드라이버를 인식하는 주체

- 운영체제

## 8-2 다양한 입출력 

- 프로그램 입출력
- 메모리 맵 입출력
- 고립형 입출력
- 인터럽트 기반 입출력
- DMA 입출력
- 입출력 버스

### 프로그램 입출력

- 프로그램 속 명령어로 입출력 장치 제어

CPU 는 어떻게 입출력장치의 레지스터 위치를 알까?


정확한 위치파악은 어려움 -> 그럼 어떻게 명령어로 표현할까?
- 메모리 맵 입출력
- 고립형 입출력


### 메모리 맵 입출력

- 주소공간 메모리 주소와 같이씀
- CPU 는 메모리 주소던 레지스터 주소던 똑같이 대함
  - 517 번지를 읽어라 의 517 이 메모리면 메모리를 읽으면되고 키보드면 키보드를 읽으면 됨
- 메모리와 같은 명령어 사용

### 고립형 입출력
- 메모리 주소/ 입출력 장치 주소 공간 분리
- 메모리 주소공간 축소 안됨
- 입출력 전용 명령어

### 인터럽트 입출력
- 하드웨어 인터럽트는 장치 컨트롤러 에서 일어남
- 장치 컨트롤러가 제어하는 동안 CPU 다른 일 할 수 있음
- 입출력 작업 끝낸뒤 CPU 에게 인터럽트 -> CPU 하던 일 백업, 인터럽트 서비스 루틴 실행

### 폴링
- CPU 가 입출력장치 상태 주기적으로 확인, 처리할 데이터 있는지 주기적 확인
- cpu 부담 인터럽트보다 큼

### PIC
- programmable Interrupt controller
- 매번 인터럽트도 순차적 처리 할 수 없다
- 우선순위가 다름
- NMI
  - non maskable interrupt
- 지금 처리해야할 인터럽트는 무엇인가 알려줌



### PIC 인터럽트 처리 과정
1. PIC가 장치 컨트롤러부터 인터럽트 요청 신호 받아들임
2. PIC 우선순위 판단 -> CPU 에게 요청신호 보냄
3. CPU는 PIC에 인터럽트 확인 신호 보냄
4. PIC '데이터 버스' 통해 CPU 인터럽트 벡터 보냄
5. CPU 인터럽트 벡터 통해 인터럽트 주체 알게 됨 -> 인터럽트 서비스 루틴
<br></br>
- PIC 는 보통 두개 이상의 계층으로 구성
- NMI 까지 우선순위 판별하지 않음
    - 하드웨어 인터럽트에 한해 판단


### DMA (Direct Memory Access) 입출력
- 매번 cpu 를 거치는 연산을 개선
- 메모리와 입출력장치가 cpu 거치지 않고 정보 주고 받음
- DMA 컨트롤러 가 대신 장치 컨트롤러와 소통
- cpu 는 오직 시작과 끝에만 관여

### cons?
- 시스템 버스는 공용자원
- dma가 시스템 버스 사용할 때 cpu 시스템 버스 사용 못함, vice versa
  - cycle stealing


### 입출력 버스
- 위의 cycle stealing 을 줄이기위해
- 따로 입출력 버스에서 통신
- 대부분의 현대 컴퓨터에 있음




