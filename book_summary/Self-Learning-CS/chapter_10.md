# 10. 프로세스와 스레드

- 프로세스
- 프로세스 제어 블록
- 문맥 교환
- 프로세스 사용자 영역

## 10-1 프로세스 개요

- foreground process
  - 보이는 공간 에서 실행됨
- background process
  - 보이지 않는 공간에서 실행
  - 사용자와 interaction 없이 묵묵히 실행되는 background process
    - unix -> daemon
    - 윈도우 -> service

### 프로세스 제어 블록

- 모든 프로세스가 cpu(프로세서)를 동시 사용불가
  - 타이머 인터럽트 발생시 차례 양보
    - 하드웨어 인터럽트이다 (타임아웃 인터럽트)
- cpu 자원 을 배분하기위해 운영체제는 'PCB' 이용
  - process control block
  - 프로세스와 관련된 정보 저장
  - 커널 영역
  - 프로세스 생성시에 pcb 생성 폐기시에 pcb 폐기

### PCB 에 담기는 정보

- PID
  - 프로세스 식별 ID
- 레지스터 값
  - PCB 가 사용했던 프로그램 카운터.. 등등
- 프로세스 상태
  - CPU 사용 대기중? CPU 사용중?
- CPU 스케줄링 정보
- 메모리 관리 정보
  - 프로세스가 어느 메모리 주소에 위치?
  - 베이스 레지스터, 한계 레지스터
  - 페이지 테이블
- 입출력 장치 목록, 사용한 파일
  - 어떤 입출력 장치가  프로세스에 할당 되었나?
  - 어떤 파일을 열었는지?

### 문맥 교환

- 하나의 프로세스를 재개하기위해 기억해야할 정보 '문맥' (context)
  - 인터럽트 발생시 context 를 백업한다
  - 그리고 진행할 다른 프로세스의 context 를 복구한다
- 위의 두 과정을 문맥 교환 'context switching'

- 문맥교환 너무 자주 일어나면 오버헤드 발생


### 프로세스 메모리 영역

프로세스 생성하면
- 커널 영역에 PCB 생성
- 사용자 영역에
  - 코드 영역 (code segment)
    - 텍스트 영역이라고도 함
    - CPU 가 실행 할 명령어 담겨있음
    - '쓰기 금지'
    - 정적 할당 영역
  - 데이터 영역
    - 프로그램이 실행되는 동안 유지될 데이터
    - '전역 변수'
    - 정적 할당 영역
  - 힙 영역
    - 사용자가 직접 할당할 수 있는 저장 공간
    - 메모리 공간을 할당했다면 해당 공간 반환 해야함
    - 반환하지 않으면 memory leak
    - 동적 할당 영역
  - 스택 영역
    - 데이터 일시 저장
    - 매개변수 지역변수
    - 저장 push, 필요하지 않은 데이터 pop
---
## 10-2 프로세스 상태와 계층 구조
- 프로세스 상태
- 부모 프로세스
- 자식 프로세스
- 프로세스 계층 구조

![img src](https://user-images.githubusercontent.com/49462767/225651073-ee98eef5-7be7-4b4d-9d33-5523bf2e4098.png)

- 어딘가 익숙하다...
- 프로세스 상태 : 응답 없음

### 프로세스 상태
- 생성 상태
- 준비 상태
  - 준비 상태 -> 실행 상태 로 전환하는 것을 dispatch라고 함
- 실행 상태
  - 타이머 인터럽트 발생하면 대기상태가 됨
  - 일정 시간 동안만 CPU 사용
- 대기 상태
  - 대기 상태의 대부분이 입출력 작업 대기중인 케이스
  - 입출력장치가 입출력을 보낼때 (입출력 인터럽트가 발생할 때) 까지 대기
  - blocked
  - 입출력 장치가 아닌경우도 있기는함
  - 입출력 작업 끝나면 준비 상태로 CPU 할당 기다림
- 종료 상태
  - terminated

### 프로세스 계층 구조

>많은 운영체제가 프로세스가 프로세스를 낳는 계층적 구조로써 관리

- parent process
  - ppid (parent pid)
- child process

### 최초의 프로세스?
- unix : init
- linux : systemD
- launchD

>최초의 프로세스의  PID 는 1번이다

```
pstree
```

### 프로세스 생성 기법

부모 프로세스는 어떻게 자식 프로세스를 생성하는지?

- fork
- exec
- 위 둘다 시스템 호출

- fork
  - 자신의 복사본 자식 프로세스로 생성
  - 복사본 만드는 시스템호출
  - 복사된 프로세스라도 PID 나 메모리 위치는 다르다
- exec
  - 자신의 메모리 공간을 새로운 프로그램으로 덮어쓰는 시스템 호출
  - 새로운 옷을 갈아입음

## 10-3 스레드
- thread
- multi process
- multi thread

- 스레드: 프로세스를 구성하는 실행의 흐름 단위
  - 프로세스 내에 각기 다른 스레드 ID
  - 프로그램 카운터 값
  - 레지스터 값
  - 스택
- 각기 다른 값 덕분에 스레드마다 각기 다른 코드를 실행 가능

- 최근의 운영체제는 cpu 에 처리할 작업을 전달할때 스레드 단위로 전달
- 실행에 필요한 최소한의 정보만 유지한 채 프로세스 자원 공유하면서 실행됨

**리눅스는 프로세스와 스레드를 구분하지 않는다**
- 프로세스, 스레드 대신 'task'라고 통일하여 명명
- 구분 지을 필요 없다 라는게 리눅스의 철학


### 멀티 프로세스와 멀티 스레드
- 멀티 프로세스
  - 프로세스 여러개 동시에 실행
- 멀티 스레드
  - 여러 스레드로 프로세스를 동시에 실행

### 차이가?
- 프로세스 끼리는 자원을 공유하지 않음
  - 독립 실행
- 스레드는 공유한다
  - 협력, 통신
  - 자원 효율적

### 멀티스레드의 단점

- 멅티 프로세스
  - 하나의 프로세스가 문제가 생기면 다른프로세스 영향 없음
- 멀티 스레드
  - 하나의 스레드에 문제가 생길 시 프로세스 전체 문제


### IPC (Inter-Process-Communication)
- 프로세스 간 통신
  - 파일을 통한 프로세스간 통신
  - 공유 메모리
  - 소켓, 파이프
