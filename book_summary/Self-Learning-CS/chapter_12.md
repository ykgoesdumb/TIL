# 12. 프로세스 동기화
- 동기화
- 공유자원
- 임계 구역 문제
## 12-1 동기화란
- 프로세스의 실행 순서와
- 자원의 일관성을 보장하기 위한 프로세스 관리 서비스

### 프로세스 동기화
- 실행 순서 제어
  - 프로세스를 순서대로 실행하게 하기
  - write -> read 가 되어야하는데 프로세스 무작정 실행되면 쓰기도 전에 읽어버림
- 상호 배제
  - 동시에 접근해서 안되는 자원에 하나의 프로세스만 접근하게 하기
  - 계좌의 잔액에 입금하는 두개의 프로세스가 있다고 가정
    - 하나의 프로세스가 끝나고 잔액을 변경한뒤에 그 다음 프로세스를 받아야 정확한 잔액 계산이 가능
    - 잔액정보가 갱신되기도 전에 동시에 입금 프로세스가 처리가 된다면 자원의 일관성이 깨질 수 있음

- 하나의 자원에 일관성이 깨진 예시
![img src](https://user-images.githubusercontent.com/49462767/226089199-f1b3051d-d7e6-4821-a738-f3c65203f996.png)

- producer 는 계속 1을 100000 번 더하고 
- consumer 는 계속 1을 100000 번 뺀다
- 이론상으로 처음에 시작하 10이 유지가 되어야 하지만 하나의 자원에 동시에 접근하면서 일관성이 깨져서 기대와 다른 결과값들이 나오는 모습.

### 공유 자원 임계 구역

- shared resource
  - 위의 '잔액' 이 공유 자원의 한 예시로 들 수 있음
- 임계 구역 (critical section)
  - '공유 자원' 에 접근하는 코드 영역
  - race condition
    - 프로세스가 실수로 동시 다발적으로 임계구역의 코드를 실행 한경우
    - 왜 생길까?
    - 컴퓨터가 프로세스 고급언어 -> 저급언어로 변환하는 과정 에서 문맥 교환이 일어남
    - 데이터 일관성 깨짐

### 운영체제의 동기화 3원칙
- 상호배제 (mutual exclusion)
  - 한 프로세스가 임계구역에 들어갈 경우 다른 프로세스 못들어감
- 진행
  - 임계구역에 어느 프로세스도 들어가있지 않다면 임계구역 진입하고자 하는 프로세스 들어갈 수 있음
- 유한 대기
  - 임계구역에 진입시도하는 프로세스는 무한정 대기가 아닌 언젠가 들어올 수 있게 해야함

---

## 12-2 동기화 기법

### 뮤텍스 락 (mutual exclusion lock)
> 뮤텍스 락은 임계구역 -> 탈의실, 프로세스 -> 손님 에 비유하면 이해가 쉽다
- 하나의 프로세스가 들어가면 임계구역을 걸어잠근다

- 하나의 전역변수와 두개의 함수로 구성
  - lock: 프로세스들이 공유하는 전역 변수
  - acquire: 임계구역을 잠금
    - lock 을 true 로 
    - lock 이 true 인 경우 지속적으로 lock 을 체크한다
      - busy wait
      - 탈의실문 잠겼는지 계속 두드려 
  - release: 임계구역을 빠져나오면서 잠금해제
    - lock 을 false 로

### 세마포 (semaphore)

- 공유자원이 여러개 있는경우도 적용가능한 방법
- 탈의실이 n개 있는 상황이라고 볼 수 있음
- 구성 
  - 임계구역에 접근 가능한 프로세스의 갯수를 나타내는 전역변수 S
    - S 가 1 이상이라면 wait 호출하고 S1 감소시키고 임계구역 입장
    - S 가 0 이라면 PCB 의 waiting queue 에 등록
    - signal 함수 호출할때 S 1 증가
  - wait 함수
    - 들어가도 좋은지 기다려야 하는 지 알려주는 함수
  - signal
    - 들어가라는 신호를 전달하는 함수

- 사용자가 signal 함수를 특정 프로세스에 호출함으로써 프로세스 순서 제어할 수 있음
- 하지만 사용자 입장에서 wait 과 signal을 일일히 명시하는것이 편하지 않을 수 있음
  - 휴먼 에러 발생 가능성 높음


### 모니터 (monitor)

