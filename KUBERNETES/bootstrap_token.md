# bootstrap token

Kubernetes에서 Bootstrap Token은 새로운 워커 노드를 클러스터에 등록하는 데 사용되는 인증 토큰

- 이 토큰은 kubelet이 클러스터에 가입하는 데 사용되며, 클러스터 내에서 신뢰할 수 있는 인증을 받을 수 있다
- Kubelet TLS 부트스트래핑 시스템과 함께 동작하도록 구축
- Bootstrap Token은 보안 상의 이유로 일반적으로 클러스터를 초기화할 때만 사용한다
- 클러스터를 초기화할 때는, 새로운 워커 노드를 등록하려는 사용자가 클러스터 관리자이며, 이 사용자가 발급한 Bootstrap Token을 사용하여 새로운 노드를 클러스터에 등록한다


# bootstrap overview

부트스트랩 토큰은 kube-system 네임스페이스에 있는 특정 유형(bootstrap.kubernetes.io/token)의 시크릿(Secret)으로 정의
- description, id, secret, usage, groups 등의 정보를 가지고 있다. 
  - description은 토큰에 대한 설명
  - id는 토큰의 고유 식별자 
  - secret은 토큰을 검증하는 데 사용되는 비밀 값 
  - usage는 토큰의 용도 
  - groups는 토큰으로 인증된 사용자가 속한 그룹의 리스트



# bootstrap token auth activate

```sh
---enable-bootstrap-token-auth
```



```yaml
apiVersion: v1
kind: Secret
metadata:
  # Name MUST be of form "bootstrap-token-<token id>"
  name: bootstrap-token-07401b
  namespace: kube-system

# Type MUST be 'bootstrap.kubernetes.io/token'
type: bootstrap.kubernetes.io/token
stringData:
  # Human readable description. Optional.
  description: "The default bootstrap token generated by 'kubeadm init'."

  # Token ID and secret. Required.
  token-id: 07401b
  token-secret: f395accd246ae52d

  # Expiration. Optional.
  expiration: 2017-03-10T03:22:11Z

  # Allowed usages.
  usage-bootstrap-authentication: "true"
  usage-bootstrap-signing: "true"

  # Extra groups to authenticate the token as. Must start with "system:bootstrappers:"
  auth-extra-groups: system:bootstrappers:worker,system:bootstrappers:ingress
```
# kubernetes cluster reset
새로운 워커 노드를 클러스터에 등록하려면, 다음과 같은 단계를 따를 수 있다.

1. 클러스터 관리자는 새로운 워커 노드를 등록할 사용자에게 Bootstrap Token을 발급.

2. 새로운 워커 노드에서 kubelet을 시작하고, Bootstrap Token을 사용하여 클러스터에 가입.

3. 클러스터 관리자는 새로운 워커 노드를 검증하고, 적절한 권한을 부여.

Bootstrap Token은 보안 상의 이유로 새로운 노드를 등록할 때만 사용되며, 클러스터에서 사용자 인증을 위한 다른 메커니즘, 예를 들어 서명된 인증서와 키를 사용하는 방법을 사용해야 한다.